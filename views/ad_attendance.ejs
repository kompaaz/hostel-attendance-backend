<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hostel Attendance</title>
<link rel="stylesheet" href="/css/attendance.css">

</head>
<body>
  <header>
    <h2>üìù Hostel Attendance</h2>
    <div id="datetime"></div>
  </header>

  <div id="attendance-container">
    <% Object.entries(groupedUsers).forEach(([room, students]) => { %>
      <div class="room-card">
        <div class="room-title">Room <%= room %></div>
        <div class="student-list">
          <% students.forEach((student) => { %>
            <div class="student-card" data-name="<%= student.name %>">
              <div class="student-name"><%= student.name %> (<%= student.roll %>)</div>
              <div class="status-buttons">
                <button class="status-btn present">P</button>
                <button class="status-btn absent">A</button>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    <% }); %>
  </div>

  <button id="saveBtn">‚úÖ Save Attendance</button>
  <div id="summary">Total Present: 0 | Total Absent: 0</div>

  <script>
    const statusMap = {};

    function updateSummary() {
      let present = 0;
      let absent = 0;

      document.querySelectorAll(".student-card").forEach(card => {
        const name = card.dataset.name;
        const pBtn = card.querySelector(".present");
        const aBtn = card.querySelector(".absent");

        if (pBtn.classList.contains("active")) {
          statusMap[name] = "present";
          present++;
        } else if (aBtn.classList.contains("active")) {
          statusMap[name] = "absent";
          absent++;
        }
      });

      document.getElementById("summary").textContent =
        `Total Present: ${present} | Total Absent: ${absent}`;
    }

    document.querySelectorAll(".student-card").forEach(card => {
      const name = card.dataset.name;
      const pBtn = card.querySelector(".present");
      const aBtn = card.querySelector(".absent");

      pBtn.addEventListener("click", () => {
        pBtn.classList.add("active");
        aBtn.classList.remove("active");
        statusMap[name] = "present";
        updateSummary();
      });

      aBtn.addEventListener("click", () => {
        aBtn.classList.add("active");
        pBtn.classList.remove("active");
        statusMap[name] = "absent";
        updateSummary();
      });
    });

    document.getElementById("saveBtn").onclick = () => {
      if (confirm("Are you sure you want to submit today's attendance?")) {
        alert("‚úÖ Attendance Submitted!");
        // Send statusMap via fetch() if needed.
        console.log(statusMap);
      }
    };

    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleString("en-IN", {
        weekday: 'short',
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit',
      });
      document.getElementById("datetime").textContent = timeStr;
    }

    setInterval(updateTime, 1000);
    updateTime();
    updateSummary();
  </script>
</body>
</html>
