<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hostel Attendance</title>
<link rel="stylesheet" href="/css/attendance.css">
<style>
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    background-color: #f8fafc;
    border-bottom: 1px solid #ddd;
    flex-wrap: wrap;
    border-radius: 10px;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

.header-left img {
  height: 100px;
  width: auto;
  /* object-fit: contain;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px; optional: smooth corners */
}

  .header-left h2 {
    margin: 0;
    font-size: 1.5rem;
    white-space: nowrap;
  }

  #datetime {
    font-weight: bold;
    font-size: 1rem;
    white-space: nowrap;
  }

@media (max-width: 600px) {
  header {
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }

    .header-left {
        flex-direction: column;

    }
  .header-left img {
    height: 80px;
    /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.289); */
  }

  .header-left h1 {
    font-size: 1.2rem;
    display: none;
  }

  #datetime {
    align-self: center;
    font-size: 0.9rem;
  }
}

</style>

</head>
<body>

<header>
  <div class="header-left">
    <img src="/img/logo.png" alt="Logo" />

     <h1>E-Attendance</h1>
  </div>
  <div id="datetime"></div>
</header>



  <div id="attendance-container">
    <% Object.entries(groupedUsers).forEach(([room, students]) => { %>
      <div class="room-card">
        <div class="room-title">Room <%= room %></div>
        <div class="student-list">
          <% students.forEach((student) => { %>
            <div class="student-card" data-name="<%= student.name %>">
              <div class="student-name"><%= student.name %> (<%= student.dNo %>)</div>
              <div class="status-buttons">
                <button class="status-btn present">P</button>
                <button class="status-btn absent">A</button>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    <% }); %>
  </div>

  <button id="saveBtn">✅ Save Attendance</button>
  <div id="summary">Total Present: 0 | Total Absent: 0</div>

  <script>
    const statusMap = {};

    function updateSummary() {
      let present = 0;
      let absent = 0;

      document.querySelectorAll(".student-card").forEach(card => {
        const name = card.dataset.name;
        const pBtn = card.querySelector(".present");
        const aBtn = card.querySelector(".absent");

        if (pBtn.classList.contains("active")) {
          statusMap[name] = "present";
          present++;
        } else if (aBtn.classList.contains("active")) {
          statusMap[name] = "absent";
          absent++;
        }
      });

      document.getElementById("summary").textContent =
        `Total Present: ${present} | Total Absent: ${absent}`;
    }

    document.querySelectorAll(".student-card").forEach(card => {
      const name = card.dataset.name;
      const pBtn = card.querySelector(".present");
      const aBtn = card.querySelector(".absent");

      pBtn.addEventListener("click", () => {
        pBtn.classList.add("active");
        aBtn.classList.remove("active");
        statusMap[name] = "present";
        updateSummary();
      });

      aBtn.addEventListener("click", () => {
        aBtn.classList.add("active");
        pBtn.classList.remove("active");
        statusMap[name] = "absent";
        updateSummary();
      });
    });

    document.getElementById("saveBtn").onclick = () => {
      if (confirm("Are you sure you want to submit today's attendance?")) {
        alert("✅ Attendance Submitted!");
        // Send statusMap via fetch() if needed.
        console.log(statusMap);
      }
    };

    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleString("en-IN", {
        weekday: 'short',
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit',
      });
      document.getElementById("datetime").textContent = timeStr;
    }

    setInterval(updateTime, 1000);
    updateTime();
    updateSummary();
  </script>
</body>
</html>
